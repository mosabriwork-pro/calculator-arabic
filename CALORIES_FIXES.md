# تصحيحات حسابات السعرات الحرارية - موصبري برو

## المشاكل التي تم حلها

### 1. معادلة BMR خاطئة
**المشكلة:** الكود كان يستخدم معادلة خاطئة:
```typescript
// ❌ معادلة خاطئة
const bmr = 10 * weight + 6.25 * height - 5 * age + 5
```

**الحل:** تم استبدالها بالمعادلات الصحيحة:
```typescript
// ✅ للرجال (ذكر)
BMR_male = 66.47 + (13.75 × الوزن) + (5 × الطول) − (4.7 × العمر)

// ✅ للنساء (أنثى)  
BMR_female = 655 + (9.6 × الوزن) + (1.85 × الطول) − (4.7 × العمر)
```

### 2. عوامل النشاط غير صحيحة
**المشكلة:** كان عامل "نشاط خفيف" 1.375
**الحل:** تم تصحيحه إلى 1.376 حسب المواصفات

### 3. إضافة حقل الجنس
**المشكلة:** لم يكن هناك حقل لاختيار الجنس
**الحل:** تم إضافة حقل اختيار الجنس (ذكر/أنثى) في واجهة المستخدم

## الملفات التي تم تعديلها

### 1. `src/utils/calories.ts` (جديد)
- دوال حساب BMR و TDEE صحيحة
- التحقق من صحة المدخلات
- عوامل النشاط الصحيحة

### 2. `src/app/calculator/page.tsx`
- استبدال الحسابات الخاطئة بالدوال الصحيحة
- إضافة حقل الجنس
- تحديث validation
- تحديث PDF report

### 3. `src/__tests__/calories.test.ts` (جديد)
- اختبارات شاملة للحسابات
- التحقق من صحة المعادلات
- اختبارات المدخلات

## أمثلة على الحسابات الصحيحة

### مثال 1: ذكر، وزن 70 كجم، طول 175 سم، عمر 25 سنة
```
BMR = 66.47 + (13.75×70) + (5×175) − (4.7×25)
     = 66.47 + 962.5 + 875 − 117.5 
     = 1786.47 → 1786
```

### مثال 2: أنثى، وزن 60 كجم، طول 165 سم، عمر 25 سنة
```
BMR = 655 + (9.6×60) + (1.85×165) − (4.7×25)
     = 655 + 576 + 305.25 − 117.5 
     = 1418.75 → 1419
```

## عوامل النشاط الصحيحة
```typescript
const ACTIVITY_FACTORS = {
  'كسول (بدون تمرين)': 1.2,
  'نشاط خفيف (1-2 يوم تمرين اسبوعيا)': 1.376,  // ✅ مصحح
  'نشاط متوسط (3-4 أيام تمرين اسبوعيا)': 1.55,
  'نشاط عالي (5-6 أيام تمرين اسبوعيا)': 1.725,
  'نشاط مكثف (تمرين يومي + نشاط بدني)': 1.9
}
```

## التحقق من صحة المدخلات
- الوزن: 20-250 كجم
- الطول: 100-230 سم  
- العمر: 9-80 سنة
- الجنس: ذكر أو أنثى

## الاختبارات
تم إنشاء 26 اختبار شامل يتحقق من:
- صحة حسابات BMR
- صحة حسابات TDEE
- عوامل النشاط
- التحقق من المدخلات
- القيم الحدية

## النتيجة
✅ جميع الحسابات الآن صحيحة ومطابقة للمواصفات العلمية
✅ إضافة حقل الجنس لتحسين الدقة
✅ اختبارات شاملة تضمن عدم تكرار الأخطاء
✅ الكود جاهز للإنتاج
